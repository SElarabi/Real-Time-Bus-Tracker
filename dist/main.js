(()=>{mapboxgl.accessToken="pk.eyJ1Ijoic29mdGV4cGVyaW1lbnQiLCJhIjoiY2tjMngyZm9rMDFvajJzczJ3aWo0bnh6aiJ9.Bc_qK9Xf8SFBXkFM_x2gpg";let t=[],e=[],a=[],n=[],o=[];const s=new mapboxgl.Map({container:"map",style:"mapbox://styles/mapbox/streets-v12",center:[-71.101,42.358],zoom:12});async function r(){try{const a=await fetch("https://api-v3.mbta.com/vehicles?api_key=172ad98635c0434da2487ac7bf45418c&filter[route]=1"),r=await a.json();t=r.data,t.forEach((t=>{const a=(n=t.id,e.find((t=>t.id===n)));var n;a?(a.customMarkerElement.style.backgroundColor=i(t),function(t){e.find((function(e){return e.id===t.id})).marker.setLngLat([t.attributes.longitude,t.attributes.latitude])}(t)):function(t){t.attributes.direction_id;let a=t.id;const n=document.createElement("div");n.className="custom-marker";let o=i(t);n.style.backgroundColor=o;const r=document.createElement("div");r.className="label",r.textContent=t.attributes.label,r.style.position="absolute",r.style.top="50%",r.style.left="50%",r.style.transform="translate(-50%, -50%)",n.appendChild(r);let l={id:a,marker:new mapboxgl.Marker({element:n,anchor:"bottom"}).setLngLat([t.attributes.longitude,t.attributes.latitude]).addTo(s),customMarkerElement:n,labelElement:r};e.push(l)}(t)}));const l=document.getElementById("toHarvardStopsTableBody");l.innerHTML="",o.forEach(((e,a)=>{let n=e.id,o=e.attributes.at_street,s=t.find((t=>t.relationships.stop.data.id===n));const r=document.createElement("tr");r.innerHTML=`\n\t\t      <th scope="row">${a+1}</th>\n\t\t\t\t\t<td class=" station-cell ">${o||e.attributes.name}</td>\n\t\t\t\t\t<td class=" bus-cell-green ${s&&0===s.attributes.direction_id?"flash-text":""}">\n    ${s&&0===s.attributes.direction_id?s.attributes.label:"--"}\n  </td>\n\t\t\t\t\t\n\t\t\t\t `,l.appendChild(r)}));const c=document.getElementById("toBostonStopsTableBody");c.innerHTML="",n.forEach(((e,a)=>{let n=e.id,o=e.attributes.at_street,s=t.find((t=>t.relationships.stop.data.id===n));const r=document.createElement("tr");r.innerHTML=`\n\t\t\t    \n\t\t\t\t\t\t<td class=" bus-cell-red ${s&&1===s.attributes.direction_id?"flash-text":""}">\n\t\t  ${s&&1===s.attributes.direction_id?s.attributes.label:"--"}\n\t\t</td>\n\t\t<td class=" station-cell ">${o||e.attributes.name}</td>\n\t\t<th scope="row">${a+1}</th>\n\t\t\t\t\t `,c.appendChild(r)}))}catch(t){console.error("Error:",t)}}function i(t){let e=t.attributes.direction_id;return 0===e?"green":1===e?"red":void 0}window.onload=(new mapboxgl.Marker({color:"#FF3F"}).setLngLat([-71.0942,42.3601]).addTo(s),async function(){try{const t=await fetch("https://api-v3.mbta.com/stops?api_key=172ad98635c0434da2487ac7bf45418c&filter[route]=1"),e=await t.json();a=e.data,console.log("BUS STOPS ",a),n=a.slice(0,24),console.log("TO BOSTON STOPS ",n),o=a.slice(23,47).reverse(),console.log("TO HARVARD STOPS ",o),console.log("Bus Stops data loaded successfully.")}catch(t){console.error("Error fetching bus stops:",t)}}(),r(),void setInterval(r,1e4))})();